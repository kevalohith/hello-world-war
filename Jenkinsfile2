pipeline {
    agent { label params.NODE_LABEL }  

    parameters {
        string(name: 'NODE_LABEL', defaultValue: 'builder-node', description: 'Enter Builder Node label')
    }

    stages {
        stage('Setup Builder Node') {
            steps {
                script {
                    def nodeIP = sh(script: "hostname -I | awk '{print $1}'", returnStdout: true).trim()
                    echo "Node IP: ${nodeIP}"
                    
                    sh "ansible-playbook -i '${nodeIP},' -e 'target_ip=${nodeIP}' builder-node.yml"
                }
            }
        }
    }
}
